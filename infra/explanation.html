
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Explanations &#8212; Exca 0.5.15 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=953b4072" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=a9ebb0e6"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'infra/explanation';</script>
    <link rel="icon" href="../_static/exca.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Serialization" href="serialization.html" />
    <link rel="prev" title="How-to guide" href="howto.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/exca.png" class="logo__image only-light" alt=""/>
    <img src="../_static/exca.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Exca</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="user-guide.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="reference.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/facebookresearch/exca" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/exca/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="user-guide.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="reference.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/facebookresearch/exca" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/exca/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="howto.html">How-to guide</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Explanations</a></li>
<li class="toctree-l1"><a class="reference internal" href="serialization.html">Serialization</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="user-guide.html" class="nav-link">User guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Explanations</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="explanations">
<h1>Explanations<a class="headerlink" href="#explanations" title="Link to this heading">#</a></h1>
<section id="why-the-philosophy">
<h2>Why? The philosophy<a class="headerlink" href="#why-the-philosophy" title="Link to this heading">#</a></h2>
<section id="pure-python">
<span id="philosophy"></span><h3>Pure python<a class="headerlink" href="#pure-python" title="Link to this heading">#</a></h3>
<p>The tools here do not provide a script API but a way to do everything directly from Python. Specific script APIs can be easily composed on top of it if need be.</p>
</section>
<section id="parameter-validation">
<h3>Parameter validation<a class="headerlink" href="#parameter-validation" title="Link to this heading">#</a></h3>
<p>Configurations should be validated before running to avoid discovering bugs much later (eg: missing parameter, inconsistent parameters, wrong type etc). We do this by using <code class="docutils literal notranslate"><span class="pre">pydantic.BaseModel</span></code> which works as <code class="docutils literal notranslate"><span class="pre">dataclasses</span></code> but validate all parameters.</p>
</section>
<section id="fast-configs">
<h3>Fast configs<a class="headerlink" href="#fast-configs" title="Link to this heading">#</a></h3>
<p>Running a grid search requires creating a bunch of configs, so configurations should be easy and fast to create, and therefore not defer loading data/pytorch models/etc to later</p>
</section>
<section id="no-parameter-duplication-easy-to-exetend">
<h3>No parameter duplication - easy to exetend<a class="headerlink" href="#no-parameter-duplication-easy-to-exetend" title="Link to this heading">#</a></h3>
<p>Configuration hold the underlying actual functions/classes parameters. To avoid duplicating the parameters, we opt for having coupled configs and actual classes/functions like below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClassCfg</span><span class="p">(</span><span class="n">pydantic</span><span class="o">.</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MyClass&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MyClass</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">MyClassCfg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
</pre></div>
</div>
<p>With this easy pattern, building an object from the config is easy (<code class="docutils literal notranslate"><span class="pre">cfg.build()</span></code>), and adding new parameters only requires updating the config, with effective typing and low risk of silently ignored parameters because of a mismatch between configs and functions.</p>
</section>
<section id="cached-distributed-computation">
<h3>Cached/distributed computation<a class="headerlink" href="#cached-distributed-computation" title="Link to this heading">#</a></h3>
<p>The main aim of this package is to provide objects that slightly modify methods and make them
distributed and cached their results in a breeze. The <code class="docutils literal notranslate"><span class="pre">infra</span></code> objects that make this possible
are configurations that let you specify how caching should be performed and
how computation should be distributed directly within your experiment config
(including slurm partitions, number of gpus etc)</p>
</section>
<section id="modularity">
<h3>Modularity<a class="headerlink" href="#modularity" title="Link to this heading">#</a></h3>
<p>Pydantic hierarchical configuration and discriminated unions allows for modularity and reusability, as several sub-configs can be proposed for a training config, and plugging a new sub-config is straightforward.</p>
</section>
</section>
<section id="mapinfra-task-infra-differences">
<h2>MapInfra / Task Infra differences<a class="headerlink" href="#mapinfra-task-infra-differences" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TaskInfra</span></code> must be applied to a method with no parameter (except <code class="docutils literal notranslate"><span class="pre">self</span></code>). It links 1 computation to 1 job and therefore provides easy tools for accessing the job stdout/stderr/status etc.</p>
<p><code class="docutils literal notranslate"><span class="pre">MapInfra</span></code> on the other hand must be applied to a method with 1 parameter (in addition to <code class="docutils literal notranslate"><span class="pre">self</span></code>) which must be a <code class="docutils literal notranslate"><span class="pre">m</span></code>-sized iterator/sequence of items. It requires stating how to provide a unique uid for each item (throught the <code class="docutils literal notranslate"><span class="pre">item_uid</span></code> function, and it maps <code class="docutils literal notranslate"><span class="pre">m</span></code> computation (1 for each item) to <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">&lt;=</span> <span class="pre">m</span></code> jobs, packing several computations together. Because of this non-bijective mapping, there is no support for checking jobs stderr/stdout/status.</p>
</section>
<section id="uid-computation">
<h2>uid computation<a class="headerlink" href="#uid-computation" title="Link to this heading">#</a></h2>
<p>A unique id, the <code class="docutils literal notranslate"><span class="pre">uid</span></code>, is computed for each pydantic model/each config based on public instance attributes:</p>
<ul class="simple">
<li><p>which are non-defaults</p></li>
<li><p>which are not excluded through the <code class="docutils literal notranslate"><span class="pre">_exclude_from_cls_uid</span></code> class attribute list/tuple
(or class method returning a list/tuple). This allows removing parameters which do not impact
the result (eg: number of workers, device, ect…).</p></li>
</ul>
<p><em>Note</em>: <code class="docutils literal notranslate"><span class="pre">infra</span></code> objects have all their parameters excluded except <code class="docutils literal notranslate"><span class="pre">version</span></code> as the parameters affects how the computation
is performed but not the result</p>
<p>Furthermore, a specific “cache” <code class="docutils literal notranslate"><span class="pre">uid</span></code> is also computed for which additional parameters can be excluded to account for
parameters which do not impact the cached computation, but impact the class as a whole (attributes which are used
to post-process the cached computation). This is done by specifying <code class="docutils literal notranslate"><span class="pre">exclude_from_cache_uid</span></code> in the
<code class="docutils literal notranslate"><span class="pre">infra.apply</span></code> method. This cache uid is used as storage folder name for the cache.
Exclusion can be specified as a list/tuple of field, or as a method, or as the name of a method
(with format <code class="docutils literal notranslate"><span class="pre">method:&lt;method_name&gt;</span></code>). Notice that when subclassing, if you specified the exclusion
as a function, the original function will be used (not the new function if it was overriden),
if you want to use the new one, then you should specify the method through its name.</p>
<p>See more in the <a class="reference internal" href="howto.html#howto-efficient-caching"><span class="std std-ref">example</span></a> from the how-to guide.</p>
</section>
<section id="confdict">
<h2>ConfDict<a class="headerlink" href="#confdict" title="Link to this heading">#</a></h2>
<p>To simplify working with configuration dictionaries, we use <code class="docutils literal notranslate"><span class="pre">ConfDict</span></code> classes (see <a class="reference internal" href="reference.html#exca.ConfDict" title="exca.confdict.ConfDict"><span class="xref myst py py-class">their API</span></a>).
In practice, they are dictionary which breaks into sub-dictionnaries on <code class="docutils literal notranslate"><span class="pre">&quot;.&quot;</span></code> characters
such as in a config. Data can be specified either through dotted-keywords or directly through sub-dictionaries
or a mixture of both:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">exca</span> <span class="kn">import</span> <span class="n">ConfDict</span>

<span class="n">cfdict</span> <span class="o">=</span> <span class="n">ConfDict</span><span class="p">({</span><span class="s2">&quot;training.optim.lr&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">cfdict</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;optim&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">}}}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ConfDict</span></code> instance have a few convenient methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># flattens the dictionary</span>
<span class="k">assert</span> <span class="n">cfdict</span><span class="o">.</span><span class="n">flat</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;training.optim.lr&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">}</span>

<span class="c1"># export to yaml (can take a file as argument)</span>
<span class="k">assert</span> <span class="n">cfdict</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;training.optim.lr: 0.01</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="c1"># uid computation</span>
<span class="k">assert</span> <span class="n">cfdict</span><span class="o">.</span><span class="n">to_uid</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;training.optim.lr=0.01-0f8936b4&quot;</span>
</pre></div>
</div>
<p>Infra objects extensively use such dictionaries and have a <code class="docutils literal notranslate"><span class="pre">config</span></code> method for instantiating the <code class="docutils literal notranslate"><span class="pre">ConfDict</span></code> generated from an object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">task</span> <span class="o">=</span> <span class="n">TutorialTask</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">cfdict</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">infra</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">cfdict</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">}</span>
</pre></div>
</div>
<p>They are used for uid computation as shown above (with <code class="docutils literal notranslate"><span class="pre">uid=True,</span> <span class="pre">exclude_defaults=True</span></code>) but also to clone the instance
and updating its value, so that you can pass new values either through dotted-name format or through sub-dictionaries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># exports a ConfDict and reinstantiate from it</span>
<span class="n">new</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">infra</span><span class="o">.</span><span class="n">clone_obj</span><span class="p">({</span><span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">new</span><span class="o">.</span><span class="n">param</span> <span class="o">==</span> <span class="mi">14</span>
</pre></div>
</div>
</section>
<section id="caching">
<h2>Caching<a class="headerlink" href="#caching" title="Link to this heading">#</a></h2>
<p>Cache folders are created as <code class="docutils literal notranslate"><span class="pre">&lt;full_module_import_name&gt;.&lt;class_name&gt;.&lt;method_name&gt;,&lt;version&gt;/&lt;param1=value1,...&gt;</span></code></p>
<p>Eg: <code class="docutils literal notranslate"><span class="pre">mypackage.mymodule.TutorialTask.process,1/param=13-fbfu2iow</span></code></p>
<p>Under the hood, data are stored using the <code class="docutils literal notranslate"><span class="pre">CacheDict</span></code> class (see <a class="reference internal" href="reference.html#exca.cachedict.CacheDict" title="exca.cachedict.CacheDict"><span class="xref myst py py-class">API here</span></a>).
This class has a <code class="docutils literal notranslate"><span class="pre">dict</span></code>-like interface (<code class="docutils literal notranslate"><span class="pre">keys</span></code>, <code class="docutils literal notranslate"><span class="pre">items</span></code>, <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>, <code class="docutils literal notranslate"><span class="pre">__contains__</span></code>), the difference is that the data can be stored to/loaded from disk automatically, and <code class="docutils literal notranslate"><span class="pre">__setitem__</span></code> works through a write context manager for efficiency.
The class is initialized with these parameters:</p>
<ul class="simple">
<li><p>the storage folder — if present, data will be stored to/loaded from disk</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keep_in_ram</span></code> flag — if <code class="docutils literal notranslate"><span class="pre">True</span></code>, data is cached in RAM for faster access</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cache_type</span></code> — the serialization handler to use (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;MemmapArray&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;PandasDataFrame&quot;</span></code>); auto-detected if omitted</p></li>
</ul>
<p>For details on the serialization system and how to write custom handlers, see <a class="reference internal" href="serialization.html"><span class="std std-doc">Serialization</span></a>.</p>
<p><strong>Example</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">exca</span> <span class="kn">import</span> <span class="n">cachedict</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">cachedict</span><span class="o">.</span><span class="n">CacheDict</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">keep_in_ram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># the dictionary is empty:</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">cache</span>

<span class="c1"># writes require a context manager for efficiency with multiple writes</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="k">with</span> <span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">():</span>
    <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;blublu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="k">assert</span> <span class="s2">&quot;blublu&quot;</span> <span class="ow">in</span> <span class="n">cache</span>
<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;blublu&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;blublu&quot;</span><span class="p">}</span>

<span class="c1"># a new instance with the same folder sees the cached data</span>
<span class="n">cache2</span> <span class="o">=</span> <span class="n">cachedict</span><span class="o">.</span><span class="n">CacheDict</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cache2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;blublu&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>At write time, each thread/process independently creates an <code class="docutils literal notranslate"><span class="pre">*-info.jsonl</span></code> file in which each line is a JSON object providing the key and information on how to read the corresponding data.</p>
<p><code class="docutils literal notranslate"><span class="pre">CacheDict</span></code> is designed for use within an infra and may be sub-optimal for other use cases (e.g. repeated <code class="docutils literal notranslate"><span class="pre">__contains__</span></code> checks can reload keys from the filesystem to account for writes from other threads/processes).</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="howto.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How-to guide</p>
      </div>
    </a>
    <a class="right-next"
       href="serialization.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Serialization</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-the-philosophy">Why? The philosophy</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pure-python">Pure python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-validation">Parameter validation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fast-configs">Fast configs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#no-parameter-duplication-easy-to-exetend">No parameter duplication - easy to exetend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cached-distributed-computation">Cached/distributed computation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modularity">Modularity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapinfra-task-infra-differences">MapInfra / Task Infra differences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uid-computation">uid computation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confdict">ConfDict</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caching">Caching</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright Meta Platforms, Inc.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
</div>

  </footer>
  </body>
</html>